<html>
    <head>
        <title>Tuya Color Patterns</title>
        <script type="text/javascript" src="./van.nomodule.min.js" />
        <script type="text/javascript" src="./van-x.nomodule.min.js" />
        <script type="text/javascript">
            function hex2tuya(hex) {
                hex = hex.replace(/^#/,'');
                const r = parseInt(hex.substring(0,2),16);
                const g = parseInt(hex.substring(2,4),16);
                const b = parseInt(hex.substring(4,6),16);
                const hsv = rgb2hsv(r,g,b);
                const h = Math.round(hsv.h).toString(16).padStart(4,"0");
                const s = Math.round(hsv.s*10).toString(16).padStart(4,"0");
                const v = Math.round(hsv.v*10).toString(16).padStart(4,"0");
                const tuyastr = h+s+v+"00000000";
                return tuyastr;
            }

            function rgb2hsv (r, g, b) {
                // Sourced from https://stackoverflow.com/a/8023734
                let rabs, gabs, babs, rr, gg, bb, h, s, v, diff, diffc, percentRoundFn;
                rabs = r / 255;
                gabs = g / 255;
                babs = b / 255;
                v = Math.max(rabs, gabs, babs),
                diff = v - Math.min(rabs, gabs, babs);
                diffc = c => (v - c) / 6 / diff + 1 / 2;
                percentRoundFn = num => Math.round(num * 100) / 100;
                if (diff == 0) {
                    h = s = 0;
                } else {
                    s = diff / v;
                    rr = diffc(rabs);
                    gg = diffc(gabs);
                    bb = diffc(babs);

                    if (rabs === v) {
                        h = bb - gg;
                    } else if (gabs === v) {
                        h = (1 / 3) + rr - bb;
                    } else if (babs === v) {
                        h = (2 / 3) + gg - rr;
                    }
                    if (h < 0) {
                        h += 1;
                    }else if (h > 1) {
                        h -= 1;
                    }
                }
                return {
                    h: Math.round(h * 360),
                    s: percentRoundFn(s * 100),
                    v: percentRoundFn(v * 100)
                };
            }
        </script>
    </head>
    <body>
    </body>
    <script type="text/javascript" id="appcode">
        const {a, button, del, div, input, span, ul, li} = van.tags;
        const patternModes = [
            "Fade",
            "Flash",
            "Music"
        ];
        const patternTypes = [
            "Solid",
            "Up",
            "Down",
            "Center",
            "Stripe",
            "Out",
            "In",
            "Rotate",
            "Spiral"
        ];
        const patternId = Math.round(Math.random()*255).toString(16).padStart(2,"0");
        const ColorPicker = () => {
            const config = vanX.reactive({
                'id': patternId,
                'mode': 0,
                'type': 0,
                'speed': 10,
                'colors':[],
            });
            van.derive(() => {});
        };
    </script>
</html>